import streamlit as st
import pandas as pd

st.set_page_config(page_title="ì˜ì–‘ì†Œ ë¶„ì„", layout="wide")

@st.cache_data
def load_data():
    # ìë™ìœ¼ë¡œ UTF-8 ìš°ì„  ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ CP949ë¡œ ì¬ì‹œë„
    try:
        return pd.read_csv("food.csv", encoding="utf-8")
    except:
        return pd.read_csv("food.csv", encoding="cp949")

df = load_data()

st.title("ğŸ ìŒì‹ ì˜ì–‘ì†Œ ë¶„ì„ & ì¶”ì²œ ìŒì‹")

# ------------------------------
# ê²€ìƒ‰ì°½
# ------------------------------
user_input = st.text_input("ì˜ì–‘ì†Œë¥¼ ì•Œê³  ì‹¶ì€ ìŒì‹ì„ ì…ë ¥í•˜ì„¸ìš”:", "")

if user_input:
    # ì…ë ¥í•œ ìŒì‹ í¬í•¨ëœ í–‰ ê²€ìƒ‰
    result = df[df["ìŒì‹"].str.contains(user_input, case=False, na=False)]

    if len(result) == 0:
        st.error("í•´ë‹¹ ìŒì‹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
    else:
        st.subheader("ğŸ” ì„ íƒí•œ ìŒì‹ì˜ ì˜ì–‘ ì •ë³´")
        st.dataframe(result)

        # ------------------------------
        # ì¶”ì²œ ìŒì‹ ê°„ë‹¨ ë¡œì§
        # ------------------------------
        st.subheader("ğŸ¥— ì¶”ì²œ ìŒì‹")

        nutrition_cols = ["ì¹¼ë¡œë¦¬", "íƒ„ìˆ˜í™”ë¬¼", "ë‹¨ë°±ì§ˆ", "ì§€ë°©"]

        # ì˜ì–‘ì†Œ ì»¬ëŸ¼ì´ ëª¨ë‘ ìˆì„ ë•Œë§Œ ì¶”ì²œí•˜ê¸°
        if all(col in df.columns for col in nutrition_cols):
            base = result[nutrition_cols].mean()

            df["ì°¨ì´"] = (df[nutrition_cols] - base).abs().sum(axis=1)

            rec = df.sort_values("ì°¨ì´").head(5)

            st.write("ì„ íƒí•œ ìŒì‹ê³¼ ì˜ì–‘ì†Œê°€ ë¹„ìŠ·í•œ ì¶”ì²œ ìŒì‹:")
            st.dataframe(rec[["ìŒì‹"] + nutrition_cols])
        else:
            st.info("âš ï¸ ì¶”ì²œ ìŒì‹ì„ ì œê³µí•˜ë ¤ë©´ CSVì— ì¹¼ë¡œë¦¬/íƒ„ìˆ˜í™”ë¬¼/ë‹¨ë°±ì§ˆ/ì§€ë°© ì»¬ëŸ¼ì´ í•„ìš”í•©ë‹ˆë‹¤.")
