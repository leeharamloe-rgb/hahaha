import streamlit as st
import pandas as pd

st.set_page_config(page_title="ìŒì‹ ì˜ì–‘ì†Œ ë¶„ì„ê¸°", layout="wide")

# --------------------------
# CSV íŒŒì¼ ì½ê¸° (ì¸ì½”ë”© ì˜¤ë¥˜ ìë™ ì²˜ë¦¬)
# --------------------------
@st.cache_data
def load_data():
    try:
        return pd.read_csv("food.csv", encoding="utf-8")
    except:
        try:
            return pd.read_csv("food.csv", encoding="cp949")
        except:
            return pd.read_csv("food.csv", encoding="latin1")

df = load_data()

st.title("ğŸ½ï¸ ìŒì‹ ì˜ì–‘ì†Œ ë¶„ì„ê¸°")
st.write("ìŒì‹ì„ ê²€ìƒ‰í•˜ë©´ ì˜ì–‘ì†Œ ì •ë³´ë¥¼ ê°„ë‹¨í•˜ê²Œ ë³´ì—¬ì£¼ê³ , í•¨ê»˜ ë¨¹ìœ¼ë©´ ì¢‹ì€ ìŒì‹ë„ ì¶”ì²œí•´ì¤˜ìš”!")

# --------------------------
# ìŒì‹ ê²€ìƒ‰
# --------------------------
food_list = df["ìŒì‹"].unique()
search = st.text_input("ğŸ” ì˜ì–‘ì†Œë¥¼ ì•Œê³  ì‹¶ì€ ìŒì‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:")

if search:
    result = df[df["ìŒì‹"].str.contains(search, case=False, na=False)]

    if result.empty:
        st.error("âŒ í•´ë‹¹ ìŒì‹ì´ ë°ì´í„°ì— ì—†ìŠµë‹ˆë‹¤. ì´ë¦„ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.")
    else:
        food_name = result.iloc[0]["ìŒì‹"]
        st.subheader(f"ğŸœ {food_name} ì˜ì–‘ ì •ë³´ ìš”ì•½")

        # --------------------------
        # ì˜ì–‘ì†Œ ê°„ë‹¨ ìš”ì•½
        # --------------------------
        nutrient_cols = [col for col in df.columns if col != "ìŒì‹"]

        nutrients = result[nutrient_cols].iloc[0]

        summary = pd.DataFrame({
            "ì˜ì–‘ì†Œ": nutrients.index,
            "í•¨ëŸ‰": nutrients.values
        })

        # ë³´ê¸° ì‰½ë„ë¡ ì •ë ¬
        summary = summary.sort_values(by="í•¨ëŸ‰", ascending=False)

        st.dataframe(summary, use_container_width=True)

        # --------------------------
        # ìŒì‹ ê¶í•© ì¶”ì²œ (ê°€ì¥ ë†’ì€ ì˜ì–‘ì†Œ ê¸°ì¤€)
        # --------------------------
        top_nutrient = summary.iloc[0]["ì˜ì–‘ì†Œ"]

        st.subheader(f"âœ¨ '{food_name}'ì™€ ì˜ ì–´ìš¸ë¦¬ëŠ” ì¶”ì²œ ìŒì‹")

        # top nutrientê°€ ë†’ì€ ìŒì‹ 3ê°œ ì¶”ì²œ
        rec = df.sort_values(by=top_nutrient, ascending=False).head(5)

        rec = rec[rec["ìŒì‹"] != food_name].head(3)

        st.write(f"â¡ï¸ **'{top_nutrient}' ì˜ì–‘ì†Œê°€ í’ë¶€í•œ ìŒì‹ ì¶”ì²œ!**")

        st.table(rec[["ìŒì‹", top_nutrient]])
