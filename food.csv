import streamlit as st
import pandas as pd

st.title("ğŸ± ìŒì‹ ì˜ì–‘ì†Œ ê²€ìƒ‰ ì‹œìŠ¤í…œ (ì˜¤ë¥˜ í•´ê²° ë²„ì „)")

# -----------------------
# CSV ìë™ ì¸ì½”ë”© ë¡œë”©
# -----------------------
@st.cache_data
def load_data():
    encodings = ["utf-8-sig", "cp949", "euc-kr"]
    for enc in encodings:
        try:
            return pd.read_csv("food.csv", encoding=enc)
        except:
            pass
    st.error("âŒ CSV íŒŒì¼ì„ ì–´ë–¤ ì¸ì½”ë”©ìœ¼ë¡œë„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    return None

df = load_data()

if df is None:
    st.stop()

st.success("ë°ì´í„° ë¡œë”© ì™„ë£Œ!")

# -----------------------
# ì‹í’ˆëª… ì»¬ëŸ¼ ìë™ íƒìƒ‰
# -----------------------
name_candidates = ["ì‹í’ˆëª…", "ì‹í’ˆ ì´ë¦„", "ìŒì‹ëª…", "ì œí’ˆëª…"]
food_name_col = None

for c in name_candidates:
    if c in df.columns:
        food_name_col = c
        break

if food_name_col is None:
    st.error("âŒ CSV íŒŒì¼ì—ì„œ ì‹í’ˆëª… ì»¬ëŸ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì»¬ëŸ¼ëª…ì„ ì•Œë ¤ì£¼ì„¸ìš”!")
    st.stop()

# ìˆ«ìí˜• ì»¬ëŸ¼ = ì˜ì–‘ì†Œ
numeric_cols = df.select_dtypes(include=["float64", "int64"]).columns.tolist()

# -----------------------
# ìŒì‹ ê²€ìƒ‰
# -----------------------
st.subheader("ğŸ” ìŒì‹ ê²€ìƒ‰í•˜ê¸°")

search = st.text_input("ìŒì‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:")

if search:
    result = df[df[food_name_col].str.contains(search, case=False, na=False)]

    if result.empty:
        st.warning("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤!")
    else:
        st.success(f"{len(result)}ê°œ ê²°ê³¼ ì°¾ìŒ")
        st.write("ğŸ”½ ê²€ìƒ‰ ê²°ê³¼ (ì´ë¦„ ëª©ë¡)")
        st.dataframe(result[[food_name_col]].head(20))

        # ì²« ë²ˆì§¸ í•­ëª© ìë™ ì„ íƒ
        selected = result.iloc[0]

        st.subheader(f"ğŸ“Š '{selected[food_name_col]}' ì˜ì–‘ì†Œ ì •ë³´")
        st.dataframe(selected[numeric_cols].to_frame("ê°’"))
