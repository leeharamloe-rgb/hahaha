import streamlit as st
import pandas as pd

# -----------------------
# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# -----------------------
st.title("ğŸ± ìŒì‹ ì˜ì–‘ì†Œ ê²€ìƒ‰ ì‹œìŠ¤í…œ (ì‹¬í”Œ ë²„ì „)")

@st.cache_data
def load_data():
    return pd.read_csv("food.csv", encoding="cp949")

df = load_data()

st.success("ë°ì´í„° ë¡œë”© ì™„ë£Œ!")

# -----------------------
# ì‹í’ˆëª… ì»¬ëŸ¼ ìë™ íƒìƒ‰
# -----------------------
name_candidates = ["ì‹í’ˆëª…", "ì‹í’ˆ ì´ë¦„", "ìŒì‹ëª…", "ì œí’ˆëª…"]
food_name_col = None

for c in name_candidates:
    if c in df.columns:
        food_name_col = c
        break

if food_name_col is None:
    st.error("âŒ CSV íŒŒì¼ì—ì„œ ì‹í’ˆëª… ì»¬ëŸ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì»¬ëŸ¼ëª…ì„ ì•Œë ¤ì£¼ì„¸ìš”!")
    st.stop()

# ìˆ«ìí˜• ì˜ì–‘ì†Œ ì»¬ëŸ¼
numeric_cols = df.select_dtypes(include=["float64", "int64"]).columns.tolist()

# -----------------------
# ìŒì‹ ê²€ìƒ‰ ê¸°ëŠ¥
# -----------------------
st.subheader("ğŸ” ìŒì‹ ê²€ìƒ‰í•˜ê¸° (ìŒì‹ëª… ì…ë ¥)")

search = st.text_input("ìŒì‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "")

if search:
    # ê²€ìƒ‰ ê²°ê³¼ í•„í„°ë§
    result = df[df[food_name_col].str.contains(search, case=False, na=False)]

    if result.empty:
        st.warning("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")
    else:
        st.success(f"ì´ {len(result)}ê°œì˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.")
        st.dataframe(result[[food_name_col]].head(20))  # ì´ë¦„ ëª©ë¡ë§Œ ë³´ì—¬ì£¼ê¸°

        # ì²« ë²ˆì§¸ ê²°ê³¼ ìë™ ì„ íƒ
        selected_row = result.iloc[0]

        st.subheader(f"ğŸ“Š '{selected_row[food_name_col]}' ì˜ì–‘ì†Œ ì •ë³´")

        st.dataframe(selected_row[numeric_cols].to_frame("ê°’"))
